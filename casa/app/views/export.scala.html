@(csvClaims:Option[play.api.libs.json.JsArray])(implicit session: play.api.mvc.Session)

@import play.api.libs.json._
@import helper._

@header(csvClaims:JsArray) = @{
    csvClaims.value.toList match {
        case head :: tail => head.as[JsArray]
        case _ => JsArray()
    }
}
@valueList(csvClaims:JsArray) = @{
    csvClaims.value.toList match {
        case head :: tail => tail
        case _ => List.empty[JsValue]
    }
}
<!DOCTYPE html>

<html>
    <head>
        <title>Export</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/normalize.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("img/favicon.png")">

        <script src="@routes.Assets.at("javascripts/modernizr-2.6.2.min.js")" type="text/javascript"></script>
    </head>
    <body class="theme">
        @common.header(session)

        <main>
            @if(csvClaims.isDefined){
                    <table id="claimsTable">
                        <caption>List of claims</caption>
                        <thead>
                            <tr>
                                @for( elem <- header(csvClaims.get).value){
                                    <th>@{elem.as[JsString].value}</th>
                                }
                            </tr>
                        </thead>
                        <tbody>
                            @for( row <- valueList(csvClaims.get)){
                                <tr>
                                    @for(elem <- row.as[JsArray].value){
                                        <td>@{elem.as[JsString].value}</td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>


                    <div class="completebutton">
                        <a class="active" target="_blank" href="@{controllers.routes.Application.csvExport().url}"> Download</a>
                        <a class="active" id="purgeButton" href="#" onclick="confirmPurge();" >Purge</a>
                    </div>
            }else{
                <h1>No data</h1>
                <a href="/">Go home</a>
            }
        </main>

        @common.footer()

    </body>
    <script type="text/javascript">
        function confirmPurge(){
            var confirmation = confirm("Are you sure?")
            if (confirmation == true){
                document.forms[0].submit();
            }
        }
    </script>
</html>